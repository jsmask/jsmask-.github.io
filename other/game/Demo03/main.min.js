var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Common=function(e){function t(){var t=e.call(this)||this;return t.fontfamily="KaiTi",t.currency="两",t}return __extends(t,e),t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.typerEffect2=function(e,t,i,a){void 0===t&&(t=""),void 0===i&&(i=100),void 0===a&&(a=null);for(var r=t.split("$y"),n=r.length,o="",s=0;n>s;s++)o+="<font"+(s%2==1?" color=0xFFA500":"")+">"+r[s]+"</font>";console.log(o),e.textFlow=(new egret.HtmlTextParser).parser(o)},t.prototype.typerEffect=function(e,t,i,a){void 0===t&&(t=""),void 0===i&&(i=100),void 0===a&&(a=null);for(var r=t.split(""),n=r.length,o=0;n>o;o++)egret.setTimeout(function(){e.appendText(r[Number(this)]),Number(this)>=n-1&&null!=a&&a()},o,i*o)},t.prototype.changeNumber=function(e){for(var t="",i=["0","1","2","3","4","5","6","7","8","9"],a=["〇","一","二","三","四","五","六","七","八","九"],r=["","十","百","千","万","十万","百万","千万","亿","十亿","百亿","千亿","兆"],n=e.toString(),o=n.length,s=0;o>s;s++)for(var h=0;h<a.length;h++)n[s]==i[h]&&(t+=a[h]+r[o-1-s]);return t},t.prototype.getGameDate=function(){var e=new Date,t=e.getTime(),i=egret.localStorage.getItem("begindate"),a="";if(null==i){var r="begindate",n=t.toString();egret.localStorage.setItem(r,n),a="江湖历一年一月一日"}else{var o=Math.floor((t-Number(i))/1e3),s=Math.floor(o/60),h=(Math.floor(s/60),Math.floor(s/5)+1),d=Math.floor(h/30)+1,g=Math.floor(d/12)+1;a="江湖历"+this.changeNumber(g)+"年"+this.changeNumber(Math.floor(d/g))+"月"+this.changeNumber(Math.floor(h/d))+"日"}return a},t.prototype.onShakeShake=function(e,t,i){var a=this;void 0===t&&(t=null),void 0===i&&(i=2e3);var r=i,n=0,o=0,s=0,h=0,d=0,g=0,l=0,c=new egret.Motion,p=new egret.Timer(60,0),u=(2*t.width+t.x)/2-t.width/2;c.addEventListener(egret.Event.CHANGE,function(i){var c=i.accelerationIncludingGravity,f=(new Date).getTime();if(f-n>300){var v=f-n;n=f,o=c.x,s=c.y,h=c.z;var m=Math.abs(o+s+h-d-g-l)/v*1e4;p.addEventListener(egret.TimerEvent.TIMER,function(){m>200&&t&&(t.x<u?(t.x+=15,t.y-=5):t.x>u?(t.x-=15,t.y+=5):(t.x+=15,t.y-=5))},a),m>r&&e(),d=o,g=s,l=h}},this),c.start(),p.start()},t}(egret.Sprite);__reflect(Common.prototype,"Common");var Game=function(e){function t(){var t=e.call(this)||this;return t.use=new Common,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=new GameStage00;this.stage.addChild(t),this.use.getGameDate()},t}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var GameStage00=function(e){function t(){var t=e.call(this)||this;return t.use=new Common,t.role=new Role,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){var t=this;this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var i=this.stageW,a=this.stageH,r=this.use,n=!1,o=new egret.Stage;o.width=this.stageW,o.height=this.stageH,this.stage.addChild(o);var s=new egret.Sound;s=RES.getRes("bgm0_mp3");var h=s.play(0,-1),d=this.use.createBitmapByName("bg_png");this.addChild(d),d.width=this.stageW,d.height=this.stageH;var g=new egret.Stage;o.addChild(g);var l=new egret.Shape;l.graphics.beginFill(0,.7),l.graphics.drawRect(0,0,this.stageW,90),l.graphics.endFill(),g.addChild(l);var c=new egret.TextField;c.text=this.use.getGameDate(),c.size=30,c.x=30,c.y=30,c.fontFamily=this.use.fontfamily,c.textColor=16777215,g.addChild(c);var p=new egret.Stage,u=this.use.createBitmapByName("head_png");p.addChild(u),u.height=85,u.width=85,u.x=this.stageW-u.width-30,u.y=2.5,o.addChild(p);var f=new egret.Stage;o.addChild(f);var v=this.use.createBitmapByName("qplay00_png");f.addChild(v);var m=new egret.Bitmap,w=v.height/v.width;v.width=100,v.height=w*v.width,v.anchorOffsetX=v.width/2,v.anchorOffsetY=v.height/2,v.x=this.stageW-v.width/2-30,v.y=this.stageH-v.height/2-30,v.touchEnabled=!0,v.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){v.touchEnabled=!1;var t=egret.Tween.get(v);t.wait(200),t.to({width:360,height:360*w,x:i/2-60,y:a/2-120},500),t.call(function(){r.onShakeShake(function(){m=r.createBitmapByName("qplay01_png"),f.addChild(m),m.alpha=0,m.anchorOffsetX=m.width/2,m.anchorOffsetY=m.height/2,m.x=i/2,m.y=a/2+30;var e=egret.Tween.get(v);e.wait(100),e.to({alpha:0,scaleX:0,scaleY:0,x:i/2,y:a/2},400),e.call(function(){var e=egret.Tween.get(m);e.wait(400),e.to({alpha:1,rotation:-360},350),e.call(function(){n=!0})})},v,1500)})},this);var E=!1;this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(E){E=!1,h.stop(),o.parent.removeChild(o);var e=new GameStage01;t.stage.addChild(e)}if(n){n=!1,f.parent.removeChild(f),E=!0;var i=new egret.Stage;i.width=t.stageW,i.height=t.stageH;new Talk(i,"m01_png","马凌云","现在到周边搜集一下吧。没准有好运呢！");o.addChild(i)}},this)},t}(egret.DisplayObjectContainer);__reflect(GameStage00.prototype,"GameStage00");var GameStage01=function(e){function t(){var t=e.call(this)||this;return t.isSg0=!1,t.use=new Common,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){var t=this;this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.stage0=new egret.Stage,this.stage0.width=this.stageW,this.stage0.height=this.stageH,this.stage.addChild(this.stage0);var i=new egret.Sound;i=RES.getRes("bgm_mp3");var a=i.play(0,-1),r=this.use.createBitmapByName("stage1_png");this.addChild(r),r.width=this.stageW,r.height=this.stageH;var n=new egret.Stage;n.width=this.stageW,n.height=this.stageH;new Talk(n,"m23_png","翟海","你们快过来啊，看我发现了这个！");this.stage0.addChild(n);var o=0;this.isSg0=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(1==t.isSg0)if(t.isSg0=!1,o++,n.parent.removeChild(n),n=new egret.Stage,n.width=t.stageW,n.height=t.stageH,1==o){new Talk(n,"m19_png","智杖","咦？这..米田功秘籍？没听说过呀？");t.stage0.addChild(n),t.isSg0=!0}else if(2==o){new Talk(n,"m01_png","马凌云","翟海，你练练试试，可能会有不少收获~");t.stage0.addChild(n),t.isSg0=!0}else if(3==o){new Talk(n,"m21_png","翟海","嗯嗯，感觉蛮好玩的，一会儿让你们看看成果！");t.stage0.addChild(n),t.isSg0=!0}else if(4==o){var e=new egret.TextField;e.text="一个时辰后......",t.stage0.addChild(e),e.textAlign="center",e.size=35,e.width=500,e.height=50,e.strokeColor=3158064,e.stroke=2,e.fontFamily=t.use.fontfamily,e.textColor=16777215,e.x=t.stageW/2-e.width/2,e.y=t.stageH/2-e.width/2;var i=new egret.Timer(1500,1);i.addEventListener(egret.TimerEvent.TIMER,function(){new Talk(n,"m22_png","翟海","练成了，我演示下，你们看看！");e.alpha=0,t.stage0.addChild(n),t.isSg0=!0},t),i.start()}else if(5==o){var r=t.use.createBitmapByName("ditem01_jpg");r.alpha=0,r.scaleX=r.scaleY=0,t.stage0.addChild(r),r.width=t.stageW,r.height=t.stageH,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,r.x=r.width/2,r.y=r.height/2;var s=egret.Tween.get(r);s.wait(1e3),s.to({alpha:1,scaleX:1,scaleY:1},300),s.wait(3e3),s.call(function(){a.stop();var e=new GameStage00;t.stage.addChild(e),t.stage0.parent.removeChild(t.stage0)})}},this)},t}(egret.DisplayObjectContainer);__reflect(GameStage01.prototype,"GameStage01");var LoadingUI=function(e){function t(t){var i=e.call(this)||this;return i.sg=t,i.createView(),i}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=50,this.textField.size=50,this.textField.textColor=16777215,this.textField.x=this.sg.stageWidth/2-this.textField.width/2,this.textField.y=this.sg.stageHeight/2-this.textField.height/2,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="已加载:"+Math.floor(e/t*100)+"%"},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI(this.stage),this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.createGameScene=function(){this.stage.addChild(new Game)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Role=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(egret.Sprite);__reflect(Role.prototype,"Role");var Talk=function(e){function t(t,i,a,r){var n=e.call(this)||this;return n.use=new Common,n.onAddtoStage(t,i,a,r),n}return __extends(t,e),t.prototype.onAddtoStage=function(e,t,i,a){var r=this,n=new egret.Shape;n.graphics.beginFill(0,.75),n.graphics.drawRect(0,400,e.width,e.height-400),n.graphics.endFill(),e.addChild(n);var o=this.use.createBitmapByName(t),s=o.height/o.width;e.addChild(o),o.width=227,o.height=o.width*s,o.x=0,o.y=e.height-o.width*s;var h=new egret.TextField;h.text=i,h.width=o.width,h.height=60,h.size=40,h.textAlign="center",h.x=0,h.fontFamily=this.use.fontfamily,h.y=e.height-50,h.strokeColor=3158064,h.stroke=2,h.textColor=16777215,e.addChild(h);var d=new egret.TextField;d.textColor=16777215,d.x=o.width+20,d.y=e.height-200,d.fontFamily=this.use.fontfamily,d.width=e.width-o.width-20,d.height=o.height-20,e.addChild(d);var g=this;g.isComplete=!0;var l=function(){g.isComplete=!0};g.isComplete&&(g.isComplete=!1,this.use.typerEffect(d,a,80,l));var c=new egret.TextField;c.text="点击继续>>",c.textColor=16777215,c.fontFamily=this.use.fontfamily,c.size=20,c.x=e.width-130,c.y=e.height-35,c.width=120,c.textAlign="center",c.height=20,e.addChild(c);var p=function(){var e=egret.Tween.get(c);e.to({alpha:1},400),e.wait(200),e.to({alpha:.5},400),e.wait(200),e.to({alpha:1},400),e.call(p,r)};p()},t}(egret.Sprite);__reflect(Talk.prototype,"Talk");